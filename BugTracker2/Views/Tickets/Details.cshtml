@model BugTracker2.Models.Tickets


@{
    ViewBag.Title = "Details";
}

<br />
<br />
<br />

        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h3>Project: @Html.ActionLink(Model.Project.Title, "Details", "Projects", new { id = Model.ProjectId }, null)</h3>
                    <h4>@Model.Title</h4>
                    <h4>Created By: @Model.Owner.DisplayName on @Model.Created.ToString("MM/dd/yyyy")</h4>
                    @if (Model.Updated.HasValue)
            {
                        <h4 class="text-danger">Updated on @Model.Updated.Value.ToString("MM/dd/yyyy")</h4>
                    }

                    @if (Model.AssignedUserId != null)
            {
                        <h5>Assigned To: @Model.AssignedUser.LastName</h5>
                    }
                    else
                    {
                        <h3>Assigned To: <span class="text-danger">Unassigned</span></h3>
                    }
                </div>
         </div>
           
            <br />
            <br />

            <div class="col-md-offset-1 col-md-5">
                <h5>Type: @Html.DisplayFor(modelItem => Model.Type.Type)</h5>
                <h5>Priority: @Html.DisplayFor(modelItem => Model.Priority.Priority)</h5>
                <h5>Status: @Html.DisplayFor(modelItem => Model.Status.Status)</h5>
                <h5>Description: </h5>
                <h5>@Model.Body</h5>
            </div>
            <div class="comment-box">
                <div class="col-md-offset-7 col-md-12">
                    @using (Html.BeginForm("Create", "Comments", FormMethod.Post))
                    {
                        <input type="hidden" name="TicketsId" value="@Model.Id" />
                        <textarea class="commentBox" name="Body" placeholder="Add a comment..."></textarea><br />
                        <input type="submit" id="submitComment" />

                    }
                    @foreach (var comment in Model.Comments)
                    {
                        <ul>
                            <li>Posted by @comment.User.DisplayName at @comment.Created</li>
                            <li>@comment.Body</li>
                        </ul>
                        <p>
                            @Html.ActionLink("Edit", "Edit", "Comments", new { id = comment.Id }, null) |
                            @Html.ActionLink("Delete", "Delete", "Comments", new { id = comment.Id }, null)
                        </p>
                    }
                </div>
                <div class="col-md-offset-7 col-md-12">
                    @using (Html.BeginForm("Create", "Attachments", FormMethod.Post, new { enctype = "Multipart/form-data" }))
                    {
                        <input type="hidden" id="TicketsId" name="TicketsId" value="@Model.Id" />
                        <input name="image" type="file" class="form-control" id="image" />
                        <input type="submit" value="Create" class="btn btn-default" />
                    }
                    @foreach (var attachment in Model.Attachments)
                    {
                        @*<div> Posted by @attachment.User.FirstName at @attachment.Created</div>*@
                        <img src="@attachment.MediaUrl" alt="Attachment Photo" style="max-width:150px" />
                    }
                </div>
            </div>
            <div class="history-box">
                <div class="row">
                    <div class="col-md-12">
                        <h3>Ticket History: @Html.ActionLink(Model.Title, "Details", new { id = Model.Id })</h3>
                        <div class="row">
                            <div class="col-md-12">
                                @{ var ticketHistory = Model.History; }
                                @foreach (var history in ticketHistory.Reverse())
                                {
                                    <h5>@history.Date.ToString("MM/dd/yyyy")M</h5>
                                    <p>@Html.Raw(history.Body)</p>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
     @*</div>*@

        <h5>
            @Html.ActionLink("Back to List", "Index", "Tickets", new { id = Model.Id }, null)
        </h5>


