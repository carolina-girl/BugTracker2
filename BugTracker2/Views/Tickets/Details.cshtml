@model BugTracker2.Models.Tickets


@{
    ViewBag.Title = "Details";
}
<div>
    <h5>
    <input type="button" class="btn btn-primary btn-default" value="Return To Dashboard" onclick="location.href='@Url.Action("Dashboard", "Home")'" />
    @Html.ActionLink("Edit", "Edit", "Tickets", new { id = Model.Id }, new { @class = "btn btn-success btn-default", @style = "color:white" })
    <input type="button" class="btn btn-info btn-default" value="Back To List" onclick="location.href='@Url.Action("Index", "Tickets")'" />
    @Html.ActionLink("User Profile", "UserProfile", "Home", new { id = Model.Id }, new { @class = "btn btn-warning btn-default", @style = "color:white" })
    @Html.ActionLink("View Full History", "History", "Tickets", new { id = Model.Id }, new { @class = "btn btn-danger btn-default", @style = "color:white" })
    </h5>
</div>

<div id="page-wrapper">
    <div class="row">
        <div class="col-lg-12">
            <h4 class="panel-heading">Ticket Details</h4> 
            </div>
        </div>   
 <!-- /.row -->
    <div class="row">
        <div class="col-lg-2 col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                        </div>
                        <div class="col-xs-6 text-center">
                          <div class=""><h4>@Model.Priority.Priority</h4></div>
                            <div>Priority</div>
                        </div>
                    </div>
                </div>
                <a href="@Url.Action("Index", "Tickets")">
                    <div class="panel-footer">
                        <span class="pull-left">View All</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-lg-2 col-md-6">
            <div class="panel panel-green">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                        </div>
                        <div class="col-xs-6 text-center">
                            <div class=""><h4>@Model.Status.Status</h4></div>
                            <div>Status</div>
                        </div>
                    </div>
                </div>
                <a href="@Url.Action("Index", "Tickets")">
                    <div class="panel-footer">
                        <span class="pull-left">View All</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-lg-2 col-md-6">
            <div class="panel panel-yellow">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                        </div>
                        <div class="col-xs-6 text-center">
                            <div class=""><h5>@Model.Type.Type</h5></div>
                            <div>Type</div>
                        </div>
                    </div>
                </div>
                <a href="@Url.Action("Index", "Tickets")">
                    <div class="panel-footer">
                        <span class="pull-left">View All</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-lg-2 col-md-6">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                        </div>
                        <div class="col-xs-6 text-center">
                            <div class=""><h4>@Model.Attachments.Count()</h4></div>
                            <div>Attachments</div>
                        </div>
                    </div>
                </div>
                <a href="@Url.Action("Index", "Attachments")">
                    <div class="panel-footer">
                        <span class="pull-left">View All</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-lg-2 col-md-6">
            <div class="panel panel-red">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                        </div>
                        <div class="col-xs-6 text-center">
                            <div class=""><h4>@Model.Comments.Count()</h4></div>
                            <div>Comments</div>
                        </div>
                    </div>
                </div>
                <a href="@Url.Action("Index", "Comments")">
                    <div class="panel-footer">
                        <span class="pull-left">View All</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-lg-2 col-md-6">
            <div class="panel panel-warning">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                        </div>
                        <div class="col-xs-6 text-center">
                            <div class=""><h4>@Model.TicketNotify.Count()</h4></div>
                            <div>Notifications</div>
                        </div>
                    </div>
                </div>
                <a href="@Url.Action("TicketNotify", "Tickets", new { id = Model.Id })">
                    <div class="panel-footer">
                        <span class="pull-left">View All</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
   </div>
   

    <!-- /.col-lg-4 -->
<div class="row">
    <div class="col-lg-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>Ticket Details</h4>
            </div>
            <div class="panel-body">
                <div class="col-md-12 subnav">
                    <h4>Ticket: @Model.Title</h4>
                    <p><strong>Name</strong></p>
                    <p>@Html.DisplayFor(model => model.Title)</p>
                    <br />
                    <p><strong>Date Created</strong></p>
                    <p>@Model.Created.ToString("M/dd/yyyy")</p>
                    <br />
                    <p><strong>Dates Updated</strong></p>
                    <p>@String.Format("{0:d}", Model.Updated)<p>
                    <br />
                    <p><strong>Description</strong></p>
                    <p>@Html.DisplayFor(model => model.Body)</p>
                    <br />
                    <p><strong>Status</strong></p>
                    <p>@Html.DisplayFor(model => model.Status.Status)</p>
                    <br />
                    <p><strong>Type</strong></p>
                    <p>@Html.DisplayFor(model => model.Type.Type)</p>
                    <br />
                    <p><strong>Priority</strong></p>
                    <p>@Html.DisplayFor(model => model.Priority.Priority)</p>
                    <br />
                    <p><strong>Assigned Users</strong></p>
                    <p>@Html.DisplayFor(model => model.AssignedUser.FullName)</p>
                    <br />
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4>Comments</h4>
                </div>
                <div class="panel-body">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-md-12">
                                    @if (!Model.Status.ToString().Equals("Closed"))
                                    {
                                        @Html.ActionLink("New Comment", "Create", "Comments", new { id = Model.Id }, new { @class = "btn btn-danger btn-default", @style = "color:white" })
                                    }
                                </div>
                            </div>
                            @*@{ var comments = Model.Comments; }*@
                            @foreach (var comment in Model.Comments)
                            {
                                <div class="comment">
                                    <h4>Posted by @comment.User.LastName on @comment.Created.ToString("M/d/yyyy")</h4>
                                    <p>@comment.Body</p>
                                    @*@if (ViewBag.UserId == @comment.UserId || ViewContext.HttpContext.User.IsInRole("Project Manager") || ViewContext.HttpContext.User.IsInRole("Admin"))
                                    {
                                        using (Html.BeginForm("Delete", "Comments", FormMethod.Post, new { onsubmit = "return confirm('Are you sure you want to delete this comment?')" }))
                                        {
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="Id" value="@comment.Id" />
                                            <input type="hidden" name="TicketsId" value="@comment.TicketsId" />
                                            <div class="form-group comment-btn-delete">
                                                <input type="submit" value="Delete" class="delete" />
                                            </div>
                                        }
                                    }*@
                                </div>
                            }
                        </div>
                    </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <ul class="timeline">
                                @foreach (var comment in Model.Comments.OrderByDescending(c => c.Created))
                                {
                                    <li>
                                        <div class="timeline-badge">
                                            <i class="fa fa-check"></i>
                                        </div>
                                        <div class="timeline-panel">
                                            <div class="timeline-heading">
                                                <h4 class="timeline-title">@comment.Created.ToString("M/d/yyyy")</h4>
                                                <p>
                                                    <small class="text-muted"><i class="fa fa-clock-o"></i>@comment.User.FullName</small>
                                                </p>
                                            </div>
                                            <div class="timeline-body">
                                                <p>@comment.Body</p>
                                            </div>
                                        </div>
                                    </li>
                                }
                            </ul>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
            @*</div>*@
        @*</div>*@
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4> Ticket Notifications </h4>
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div class="table-responsive">
                    <div class="box-body">
                        @if (Model.TicketNotify.Count() == 0)
                        {
                            @: No notifications for you for this ticket
                            }
                        else
                        {
                            <table id="mytable" class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Notification Sent To</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    @foreach (var item in Model.TicketNotify)
                                    {
                                        <tr>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.NotifyUser.FullName)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.NotifyUser.Email)
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        }
                    </div>   <!-- /.box-body -->
                </div>  <!-- /.box -->
            </div>   <!-- /.col -->
        </div>  <!-- /.row -->
   </div>

        <div class="col-lg-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4> Ticket History </h4>
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="table-responsive">
                        <div class="box-body">
                            @if (Model.History.Count() == 0)
                            {
                                @: No history for this ticket to view
                            }
                            else
                            {
                                <table id="table" class="table table-striped table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Ticket</th>
                                            <th>Description</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.History)
                                        {
                                            <tr>
                                                <td>
                                                   @item.Date.ToString("M/d/yyyy")
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Ticket.Title)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Body)
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }

                        </div>   <!-- /.box-body -->

                    </div>  <!-- /.box -->
                </div>   <!-- /.col -->
            </div>  <!-- /.row -->
     

        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>Attachments</h4>
                </div>
            <div class="panel-body">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-12">
                            @if (!Model.Status.ToString().Equals("Closed"))
                            {
                                @Html.ActionLink("New Attachment", "Create", "Attachments", new { id = Model.Id }, new { @class = "btn btn-success btn-default", @style = "color:white" })
                            }
                        </div>
                    </div>

                    @foreach (var attachment in Model.Attachments)
                    {
                        <div class="col-md-12">
                            @if (@attachment.UserId != null)
                            {
                                <h5><span class="author">Posted by @attachment.User.FullName on @attachment.Created.ToString("M/d/yyyy")</span></h5>
                            }
                            <p>
                                <img src="@attachment.MediaUrl" alt="Attachment Photo" style="max-width: 300px" />
                            </p>
                            <p>@attachment.Body</p>
                        </div>
                        @*<div class="col-md-12">
                            @if (ViewBag.UserId == @attachment.UserId || ViewContext.HttpContext.User.IsInRole("ProjectManager") || ViewContext.HttpContext.User.IsInRole("Admin"))
                            {

                                using (Html.BeginForm("Delete", "Attachments", FormMethod.Post, new { onsubmit = "return confirm('Are you sure you want to delete this attachment?')" }))
                                {
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="Id" value="@attachment.Id" />
                                    <input type="hidden" name="TicketId" value="@attachment.TicketsId" />
                                    <div class="form-group comment-btn-delete">
                                        <input type="submit" value="Delete" class="delete" />
                                    </div>
                                }
                            }
                        </div>*@
                    }
                </div>
            </div>
        </div>
</div>
    </div>
          </div>



                     

  









